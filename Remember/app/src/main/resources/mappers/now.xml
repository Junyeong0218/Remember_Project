<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Config 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  <mapper namespace="com.remember.app.entity.now.NowArticleRepository">
  
  	<select id="getNowCategories" resultType="com.remember.app.entity.now.NowCategory">
  		select
  			*
  		from
  			now_category_mst;
  	</select>
  	
  	<select id="getNowArticleSummaryList" resultType="com.remember.app.entity.now.NowArticleSummary">
  		select
  			nam.id,
  			
  			nam.create_date,
  			
  			nam.category_id,
  			ncm.name as category_name,
  			
  			nam.title,
  			nam.summary,
  			
  			nti.file_name
  			
  		from
  			now_article_mst nam
  			left outer join now_category_mst ncm on(ncm.id = nam.category_id)
  			left outer join now_title_image nti on(nti.article_id = nam.id)
  			
  		group by
  			nam.id
  		
  		order by 
  			nam.create_date DESC
  		
  		limit #{page}, 10;
  			
  	</select>
  	
  	<select id="getNowArticleSummaryListAboutCategory"  resultType="com.remember.app.entity.now.NowArticleSummary">
  		select
  			nam.id,
  			
  			nam.create_date,
  			
  			nam.category_id,
  			ncm.name as category_name,
  			
  			nam.title,
  			nam.summary,
  			
  			nti.file_name
  			
  		from
  			now_article_mst nam
  			left outer join now_category_mst ncm on(ncm.id = nam.category_id)
  			left outer join now_title_image nti on(nti.article_id = nam.id)
  		
  		where
  			nam.category_id = #{categoryId}
  			
  		group by
  			nam.id
  		
  		order by 
  			nam.create_date DESC
  		
  		limit #{page}, 10;
  		
  	</select>
  	
  	<select id="getTotalArticleCount" resultType="Integer">
  		select 
  			count(id)
  		from 
  			now_article_mst; 		
  	
  	</select>
  	
  	<select id="getTotalArticleCountAboutCategory" parameterType="Integer" resultType="Integer">
  		select
  			count(id)
  		from
  			now_article_mst
  		where
  			category_id = #{categoryId};
  		
  	</select>
  	
  	<select id="getArticleDetail" parameterType="Integer" resultType="com.remember.app.entity.now.NowArticleDetail">
  		select
  			nam.id,
  			nam.user_id,
  			nam.category_id,
  			nam.title,
  			nam.contents,
  			nam.insight_title,
  			nam.insight_contents,
  			nam.create_date,
  			
  			nci.file_name
  		from 
			now_article_mst nam
			left outer join now_contents_image nci ON(nci.article_id = nam.id)
		where
			nam.id = #{articleId};
  	</select>
  	
  	<select id="getAnotherArticles" parameterType="Integer" resultType="com.remember.app.entity.now.NowAnotherArticles">
  		select
			nam.id,
			nam.title,
			nam.create_date,
			
			nti.file_name
		from
			now_article_mst_with_rownum rownum
			left outer join now_article_mst nam ON(nam.id = rownum.id)
			left outer join now_title_image nti ON(nti.article_id = rownum.id)
		where
			rownum <![CDATA[ < ]]> (select rownum from now_article_mst_with_rownum where id = #{articleId})
		order by 
			create_date desc	
		limit 3;
  	</select>
  	
  	<insert id="insertArticle" parameterType="com.remember.app.entity.now.NowArticle">
  		insert into
  			now_article_mst
  		values(
  			0,
  			2,
  			3,
  			#{title},
  			#{summary},
  			#{contents},
  			#{insight_title},
  			#{insight_contents},
  			now(),
  			now()
  		);
  		
  	</insert>
  		
  	<insert id="insertNowArticleContentsImage" parameterType="List">
	  	insert into
	  		now_contents_image
	  	values
	  	<foreach collection="list" index="index" item="item" separator=",">
	  	(
	  		0,
	  		#(item.article_id),
	  		#{item.file_name},
	  		now(),
	  		now()
	  	)
	  	</foreach>
	  	;
  	</insert>
   	
  <!-- 	<insert id="uploadNowArticle" parameterType="com.remember.app.entity.now.NowArticle">
			insert
			
			into now_article_mst am(
				am.user_id,
				am.category_id,
				am.title,
				am.contents,  
				am.create_date,
				am.update_date
			)
			
			VALUES(	
				#{user_id},
				#{category_id},
				#{title}, 
				#{contents},
				NOW(),
				NOW()
			)
			
	</insert>
	
	<insert id="insertTitleImages" parameterType="List">
			insert into
				now_title_image
			values
		<foreach collection="list" index="index" item="item" separator=",">
		(
			0,
			#{item.article_id},
			#{item.file_name},
			now(),
			now()
		)
		</foreach>
		;
	</insert>
	
	<insert id="insertContentsImages" parameterType="List">
			insert into
				now_contents_image
			values
		<foreach collection="list" index="index" item="item" separator=",">
		(
			0,
			#{item.article_id},
			#{item.file_name},
			now(),
			now()
		)
		</foreach>
		;
	</insert>
  	
  	<select id = "getNowArticleList" resultType="com.remember.app.entity.now.NowArticle">
  		select 
  			am.id,
  		
  			am.create_date,
  			am.category_id,
  			am.title,
  			am.contents,
  			ti.file_name
  		from
  			now_article_mst am
  			left outer join now_category_mst category ON(category.id = am.category_id)
  			left outer join now_title_image ti ON(ti.article_id = am.id)
  		order_by
  			am.create_date DESC
  		limit 0, 10;
  	</select>  
  	
  	<select id = "getNowArticleListWithCategory" parameterType="Integer" resultType="com.remember.app.entity.now.NowArticle">
  		select 
  			am.id,
  			
  			am.create_date,
  			am.category_id,
  			am.title,
  			am.contents,
  			ti.file_name
  		from
  			now_article_mst am
  			left outer join now_category_mst category ON(category.id = am.category_id)
  			left outer join now_title_image ti ON(ti.article_id = am.id)
  		where
  			am.category_id = {categoryId}
  		order_by
  			am.create_date DESC
  		limit 0, 10;	
  	</select>  
  	
  	<select id = "getNowArticleDetail" parameterType="Integer" resultType = "com.remember.app.responseDto.NowArticleDetailRespDto">
		select
			am.id,
			am.user_id,
			am.category_id,
			
			am.create_date,
			am.title,
			am.contents,
			ci.file_name
		from 
			now_article_mst am
			left outer join now_contents_image ci ON(ci.article_id = am.id)
		where
			am.id= #{articleId}		
  	</select>
  	
  	<select id="getNowArticleTotalCount" parameterType="Integer" resultType="Integer">
  		select
  			count(am.id)
  		from
  			now_article_mst
		limit #{page}, 10;
  	</select>
  	
  	<select id="getNowArticleTotalCountWithCategory" parameterType="Integer" resultType="Integer">
  		select
  			count(am.id)
  		from
  			now_article_mst
  			left outer join now_category_mst category ON(category.id = am.category_id)
  		where
			am.category_id= #{categoryId}	
		limit #{page}, 10;
  	</select>
  	
  	<select id = "getNowArticleRelated" parameterType="Integer" resultType="com.remember.app.entity.now.NowArticleRelated">
  		select 
  			am.id,
  			am.user_id,
  			am.title,
  			am.create_date
  			ti.file_name
  		from
  			now_article_mst
  			left outer join now_title_image ti ON(ti.article_id = am.id)
  		where
  			am.id != {articleId}
  		order_by
			
  	</select> 
  	 -->
  </mapper>
